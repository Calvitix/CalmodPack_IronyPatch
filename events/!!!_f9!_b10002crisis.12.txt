namespace = crisis
country_event = {
    id = crisis.12
    hide_window = yes
    fire_only_once = yes
    mean_time_to_happen = {
        months = 600
    }
    trigger = {
        OR = {
            is_country_type = default
            is_country_type = ascended_empire
            is_country_type = lost_empire
        }
        has_global_flag = prethoryn_subspace_echoes
    }
    immediate = {
        remove_global_flag = prethoryn_subspace_echoes
        set_global_flag = prethoryn_approaching_rim
        if = {
            limit = {
                NOT = {
                    any_country = {
                        has_country_flag = spy_orb_spots_crisis
                    }
                }
            }
            random_rim_system = {
                limit = {
                    OR = {
                        NOR = {
                        is_star_class = sc_dn
                            any_neighbor_system = {
                                exists = space_owner
                            }
                            exists = space_owner
                        }
                        AND = {
                            exists = space_owner
                            space_owner = {
                                NOR = {
                                    is_country_type = fallen_empire
                                    is_country_type = awakened_fallen_empire
                                }
                            }
                        }
                    }
                    NOT = {
                        any_neighbor_system = {
                            exists = space_owner
                            space_owner = {
                                OR = {
                                    is_country_type = fallen_empire
                                    is_country_type = awakened_fallen_empire
                                }
                            }
                        }
                    }
                }
                set_star_flag = swarm_invasion_target_1
            }
        }
        observer_event = {
            id = observer.28
        }
        every_country = {
            limit = {
                OR = {
                    is_country_type = default
                    is_country_type = ascended_empire
                    is_country_type = lost_empire
                }
                NOT = {
                    has_country_flag = spy_orb_spots_crisis
                }
            }
            country_event = {
                id = crisis.13
            }
        }
        every_country = {
            limit = {
                OR = {
                    is_country_type = default
                    is_country_type = ascended_empire
                    is_country_type = lost_empire
                }
                has_country_flag = spy_orb_spots_crisis
            }
            country_event = {
                id = megaexpanded.3
            }
        }
    }
}
